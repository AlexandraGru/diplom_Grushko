"""Add 100 customers

Revision ID: 9ed9d9dcf4b2
Revises: 8444fc2489fa
Create Date: 2025-12-17 15:34:37.826085

"""
from typing import Sequence, Union
import uuid
import random

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = '9ed9d9dcf4b2'
down_revision: Union[str, None] = 'a1b2c3d4e5f6'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None

# Названия компаний для юр. лиц
COMPANY_PREFIXES = ['ООО', 'АО', 'ПАО', 'ИП', 'ЗАО']
COMPANY_NAMES = [
    'Рога и Копыта', 'Технологии Будущего', 'СтройМастер', 'АльфаГрупп', 'БетаСервис',
    'ГаммаТех', 'ДельтаПром', 'ЭпсилонТорг', 'ЗетаЛогистик', 'ЭтаКонсалт',
    'ТетаИнвест', 'ЙотаМедиа', 'КаппаФинанс', 'ЛямбдаСофт', 'МюСтрой',
    'НюЭнерго', 'КсиТранс', 'ОмикронПлюс', 'ПиСервис', 'РоСтандарт',
    'СигмаГрупп', 'ТауТрейд', 'ИпсилонПро', 'ФиКомпани', 'ХиМаркет',
    'ПсиЛогистик', 'ОмегаХолдинг', 'ВекторПлюс', 'ГоризонтСервис', 'МеридианТорг',
    'ЗенитИнвест', 'НадирКонсалт', 'АпексГрупп', 'БазисТех', 'ВершинаПром',
    'ГрадиентСофт', 'ДинамикаТрейд', 'ЭлементПро', 'ФокусМедиа', 'ГенезисФинанс',
    'ИмпульсСтрой', 'ЮнионТранс', 'КристаллМаркет', 'ЛидерГрупп', 'МаксимумСервис',
    'НексусТех', 'ОптимаПром', 'ПрестижТорг', 'КвантумИнвест', 'РезервКонсалт'
]

# ФИО для физ. лиц (используем из миграции пользователей)
INDIVIDUAL_NAMES = [
    ('Иванов', 'Иван', 'Иванович'),
    ('Петров', 'Петр', 'Петрович'),
    ('Сидоров', 'Сидор', 'Сидорович'),
    ('Козлов', 'Козьма', 'Козьмич'),
    ('Новиков', 'Николай', 'Николаевич'),
    ('Морозов', 'Михаил', 'Михайлович'),
    ('Волков', 'Владимир', 'Владимирович'),
    ('Соловьев', 'Сергей', 'Сергеевич'),
    ('Васильев', 'Василий', 'Васильевич'),
    ('Зайцев', 'Захар', 'Захарович'),
    ('Павлов', 'Павел', 'Павлович'),
    ('Семенов', 'Семен', 'Семенович'),
    ('Голубев', 'Глеб', 'Глебович'),
    ('Виноградов', 'Виктор', 'Викторович'),
    ('Богданов', 'Борис', 'Борисович'),
    ('Воробьев', 'Валентин', 'Валентинович'),
    ('Федоров', 'Федор', 'Федорович'),
    ('Михайлов', 'Максим', 'Максимович'),
    ('Орлов', 'Олег', 'Олегович'),
    ('Андреев', 'Андрей', 'Андреевич'),
    ('Макаров', 'Марк', 'Маркович'),
    ('Никитин', 'Никита', 'Никитич'),
    ('Захаров', 'Зиновий', 'Зиновьевич'),
    ('Борисов', 'Богдан', 'Богданович'),
    ('Яковлев', 'Яков', 'Яковлевич'),
    ('Григорьев', 'Григорий', 'Григорьевич'),
    ('Романов', 'Роман', 'Романович'),
    ('Кузнецов', 'Кирилл', 'Кириллович'),
    ('Попов', 'Прохор', 'Прохорович'),
    ('Соколов', 'Степан', 'Степанович'),
    ('Лебедев', 'Леонид', 'Леонидович'),
    ('Егоров', 'Евгений', 'Евгеньевич'),
    ('Степанов', 'Станислав', 'Станиславович'),
    ('Николаев', 'Назар', 'Назарович'),
    ('Алексеев', 'Александр', 'Александрович'),
    ('Смирнова', 'Светлана', 'Сергеевна'),
    ('Кузнецова', 'Ксения', 'Константиновна'),
    ('Попова', 'Полина', 'Павловна'),
    ('Соколова', 'София', 'Степановна'),
    ('Лебедева', 'Лариса', 'Леонидовна'),
    ('Козлова', 'Кристина', 'Кирилловна'),
    ('Новикова', 'Наталья', 'Николаевна'),
    ('Морозова', 'Марина', 'Михайловна'),
    ('Петрова', 'Полина', 'Петровна'),
    ('Волкова', 'Валентина', 'Владимировна'),
    ('Соловьева', 'Светлана', 'Сергеевна'),
    ('Васильева', 'Виктория', 'Васильевна'),
    ('Зайцева', 'Зинаида', 'Захаровна'),
    ('Павлова', 'Прасковья', 'Павловна'),
    ('Семенова', 'Серафима', 'Семеновна'),
]


def generate_inn(is_legal: bool) -> str:
    """Генерирует ИНН (10 цифр для юр. лиц, 12 для физ. лиц)"""
    length = 10 if is_legal else 12
    return ''.join([str(random.randint(0, 9)) for _ in range(length)])


def upgrade() -> None:
    connection = op.get_bind()
    
    # Получаем всех существующих пользователей
    result = connection.execute(sa.text("SELECT id FROM users"))
    users = [row[0] for row in result]
    
    if not users:
        print("Warning: No users found in database. Skipping customer creation.")
        return
    
    customers_data = []
    used_inns = set()
    
    for i in range(100):
        user_id = random.choice(users)
        customer_id = str(uuid.uuid4())
        
        # 60% юр. лица, 40% физ. лица
        is_legal = random.random() < 0.6
        customer_type = 'legal_entity' if is_legal else 'individual'
        
        if is_legal:
            prefix = random.choice(COMPANY_PREFIXES)
            company = random.choice(COMPANY_NAMES)
            name = f'{prefix} "{company}"'
        else:
            surname, first_name, patronymic = random.choice(INDIVIDUAL_NAMES)
            name = f'{surname} {first_name} {patronymic}'
        
        # Генерируем уникальный ИНН
        while True:
            inn = generate_inn(is_legal)
            if inn not in used_inns:
                used_inns.add(inn)
                break
        
        customers_data.append({
            'id': customer_id,
            'name': name,
            'inn': inn,
            'customer_type': customer_type,
            'user_id': user_id
        })
    
    for customer in customers_data:
        connection.execute(
            sa.text("""
                INSERT INTO customers (id, name, inn, customer_type, user_id)
                VALUES (:id, :name, :inn, :customer_type, :user_id)
            """),
            customer
        )
    
    connection.commit()


def downgrade() -> None:
    op.execute("DELETE FROM customers")
